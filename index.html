<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quiz Multiplayer</title>

<style>
body {
  font-family: Arial;
  text-align: center;
}

img {
  max-width: 300px;
  margin: 10px;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin: 4px;
}

#gameScreen {
  display: none;
}
</style>

</head>

<body>

<div id="roomScreen">
  <h2>Salas</h2>

  <input id="playerName" placeholder="Seu nome">

  <h3>Criar sala</h3>
  <input id="theme" placeholder="Tema">
  <button onclick="createRoom()">Criar sala</button>

  <h3>Entrar em sala</h3>
  <input id="roomCode" placeholder="Código">
  <button onclick="joinRoom()">Entrar</button>

  <p id="roomInfo"></p>
</div>

<div id="gameScreen">
  <p id="gameRoomCode"></p>

  <h2 id="question">Aguardando pergunta...</h2>
  <h3 id="timer"></h3>

  <img id="img" style="display:none"><br>

  <input id="answer" placeholder="Digite a resposta">
  <button onclick="sendAnswer()">Responder</button>

  <h3>Ranking</h3>
  <ul id="ranking"></ul>
</div>

<script>
const socket = new WebSocket("wss://quiz-game-hw1x.onrender.com");

let connected = false;

const roomScreen = document.getElementById("roomScreen");
const gameScreen = document.getElementById("gameScreen");

const questionText = document.getElementById("question");
const timerText = document.getElementById("timer");
const input = document.getElementById("answer");
const img = document.getElementById("img");
const rankingList = document.getElementById("ranking");

const roomInfo = document.getElementById("roomInfo");
const gameRoomCode = document.getElementById("gameRoomCode");

/* =====================
   CONEXÃO
===================== */

socket.onopen = () => {
  connected = true;
  roomInfo.innerText = "Conectado ao servidor.";
};

socket.onclose = () => {
  connected = false;
  roomInfo.innerText = "Desconectado do servidor.";
};

/* =====================
   SALAS
===================== */

function createRoom() {
  if (!connected) {
    alert("Ainda conectando ao servidor...");
    return;
  }

  const name = document.getElementById("playerName").value || "Jogador";
  const theme = document.getElementById("theme").value;

  socket.send(JSON.stringify({
    type: "setName",
    name: name
  }));

  socket.send(JSON.stringify({
    type: "create_room",
    theme: theme,
    scoreGoal: 120
  }));
}

function joinRoom() {
  if (!connected) {
    alert("Ainda conectando ao servidor...");
    return;
  }

  const name = document.getElementById("playerName").value || "Jogador";
  const code = document.getElementById("roomCode").value.toUpperCase();

  socket.send(JSON.stringify({
    type: "setName",
    name: name
  }));

  socket.send(JSON.stringify({
    type: "join_room",
    code: code
  }));
}

/* =====================
   MENSAGENS DO SERVIDOR
===================== */

socket.onmessage = e => {
  const data = JSON.parse(e.data);

  if (data.type === "room_created") {
    gameRoomCode.innerText = "Código da sala: " + data.code;

    roomScreen.style.display = "none";
    gameScreen.style.display = "block";
  }

  if (data.type === "room_joined") {
    gameRoomCode.innerText = "Sala: " + data.code;

    roomScreen.style.display = "none";
    gameScreen.style.display = "block";
  }

  if (data.type === "room_not_found") {
    alert("Sala não encontrada.");
  }

  if (data.type === "question") {
    questionText.innerText = data.question;
    input.value = "";

    if (data.image) {
      img.src = data.image;
      img.style.display = "block";
    } else {
      img.style.display = "none";
    }
  }

  if (data.type === "timer") {
    timerText.innerText = "Tempo restante: " + data.time + " s";
  }

  if (data.type === "ranking") {
    rankingList.innerHTML = "";

    data.ranking.forEach(p => {
      const li = document.createElement("li");
      li.textContent = p.name + " - " + p.score + " pts";
      rankingList.appendChild(li);
    });
  }

  if (data.type === "end") {
    alert("Pontuação alvo alcançada!");
  }
};

/* =====================
   RESPOSTAS
===================== */

function sendAnswer() {
  if (!input.value) return;

  socket.send(JSON.stringify({
    type: "answer",
    answer: input.value
  }));

  input.value = "";
}

input.addEventListener("keypress", e => {
  if (e.key === "Enter")
    sendAnswer();
});
</script>


</body>
</html>
